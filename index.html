<!DOCTYPE html>
<html lang="ja">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>block-editor-kf</title>
		<link rel="stylesheet" href="style.css">
	</head>
	<body>
		<!-- タイトルバナー -->
		<header class="title-banner">
			<h1>block-editor-kf</h1>
		</header>

		<!-- 変換パターン設定エリア -->
		<h2>変換パターン設定</h2>

		<div id="patternSelectorContainer" class="pattern-selector">
			<!-- ラジオボタンはJSで動的に生成されます -->
		</div>

		<!-- パターン管理コントロール -->
		<div id="patternManagement">
			<button id="addPatternButton">➕ 新しいパターンを追加</button>
			<button id="renamePatternButton">✍️ パターン名を変更</button>
			<button id="deletePatternButton" disabled style="color: red">🗑️ パターンを削除</button>
		</div>

		<hr />

		<!-- 新しいタグボタン管理エリア -->
		<h2>タグボタン管理</h2>
		<div id="tagButtonManagement">
			<p style="font-size: 0.9em; margin-bottom: 10px">
				※選択中のパターンに紐づく<strong>タグボタン</strong>をカスタマイズします。
			</p>
			<button id="addNewTagButton">➕ 新しいタグボタンを追加</button>
			<div id="tagButtonList">
				<!-- 既存のタグボタンがJSでここに表示されます -->
			</div>
		</div>

		<hr />

		<!-- 書式マッピング管理エリア -->
		<h2>Word貼り付け書式マッピング</h2>
		<div id="formattingManagement">
			<p style="font-size: 0.9em; margin-bottom: 10px">
				※Wordからコピー＆ペーストした際の書式変換ルールをカスタマイズします。<br>
				※[TEXT]を含むテンプレート形式で入力してください（例: &lt;strong&gt;[TEXT]&lt;/strong&gt;）<br>
				※保存後、次回のペースト操作から新しいルールが適用されます
			</p>
			<div id="formattingList">
				<!-- 書式マッピング設定がJSでここに表示されます -->
			</div>
			<button id="saveFormattingButton" style="margin-top: 10px;">💾 書式マッピングを保存</button>
		</div>

		<hr />

		<!-- データ共有管理エリア -->
		<h2>データ共有</h2>
		<div id="dataSharingManagement">
			<p style="font-size: 0.9em; margin-bottom: 10px">
				※パターンと書式マッピングを他の人と共有できます（入力エリアの内容は含まれません）<br>
				※パスワードを設定すると、ファイルが暗号化されます
			</p>
			<div style="display: flex; gap: 10px; margin-bottom: 10px;">
				<button id="exportDataButton">📤 データをエクスポート</button>
				<button id="importDataButton">📥 データをインポート</button>
			</div>
			<input type="file" id="importFileInput" accept=".json" style="display: none;">
		</div>

		<hr />

		<!-- 入力エリア -->
		<h2>入力エリア</h2>
		<div id="container" role="list" aria-label="入力エリアのリスト"></div>
		<button id="clearAllInputsButton" style="margin-top: 10px; color: red;">🗑️ すべての入力エリアをクリア</button>

		<!-- 挿入位置セレクタ -->
		<div id="insertionPointControls">
			<label for="insertionPointSelector">挿入位置を選択:</label>
			<select id="insertionPointSelector">
				<!-- オプションはJavaScriptで動的に生成されます -->
			</select>
			<p style="font-size: 0.8em; color: #666; margin-top: 5px">
				※選択したエリアの<strong>直後</strong>に新しいタグが挿入されます。「<strong>リストの先頭</strong>」を選択すると、一番上に追加されます。
			</p>
		</div>

		<!-- タグ追加ボタン群 (JSで動的に再生成されます) -->
		<div id="tagButtonsContainer" class="tag-buttons">
			<!-- 動的なボタンがここに追加されます -->
		</div>
		<p style="font-size: 0.9em; margin-top: 10px">
			※ショートカットキーは上の「ショートカットキー管理」セクションでカスタマイズできます。
		</p>

		<hr />

		<!-- 一括変換ボタン -->
		<button id="convertToAllButton">すべてを一括変換して追記</button>
		<button id="clearOutputButton">結果をクリア</button>
		<button id="copyOutputButton">コードをコピー</button>

		<div id="outputContainer">
			<h2>変換されたHTMLコード</h2>
			<pre><code id="htmlCodeOutput" contenteditable="true" role="textbox" aria-multiline="true" aria-label="変換されたHTMLコードの編集エリア"></code></pre>
		</div>

		<!-- タグ追加/編集モーダル -->
		<div id="tagModal" class="modal" role="dialog" aria-labelledby="modalTitle" aria-modal="true" aria-hidden="true">
			<div class="modal-content">
				<span class="close" role="button" tabindex="0" aria-label="モーダルを閉じる">&times;</span>
				<h3 id="modalTitle">新しいタグボタンの追加</h3>
				<form id="tagModalForm">
					<input type="hidden" id="tagIdInput" />

					<label for="tagNameInput">ボタン名 (例: 大見出し, 外部リンク, 枠)</label>
					<input type="text" id="tagNameInput" required />

					<label for="tagTypeSelector">タグタイプ (動作モード)</label>
					<select id="tagTypeSelector">
						<option value="multi">1. マルチラインモード - 各行が個別のタグに変換</option>
						<option value="p-list">2. 段落+リストモード - テキストと箇条書きの組み合わせ</option>
						<option value="link-list">3. リンクリストモード - 複数のリンクをリスト化（[テキスト](URL)形式）</option>
						<option value="static">4. 静的モード - テンプレートをそのまま出力（入力不可）</option>
						<option value="single-link">5. 単一リンクモード - 1つのリンクを作成（[テキスト](URL)形式）</option>
						<option value="code">6. コードモード - コードをHTMLエスケープして出力（<, >, &などを変換）</option>
					</select>
					<p style="font-size: 0.8em; color: #666; margin-top: -10px">
						※入力エリアの動作（複数行の扱い、URLの取得など）を決定します。
					</p>

					<label for="tagTemplateInput">雛形 (テンプレート)</label>
					<textarea id="tagTemplateInput" rows="8" placeholder='例: &lt;div class="content"&gt;[TEXT]&lt;/div&gt; または &lt;ul&gt;[TEXT_LIST]&lt;/ul&gt; など'></textarea>
					<p style="font-size: 0.8em; color: #666; margin-top: -10px">
						※モード別プレースホルダー: 1.[TEXT] / 2.[TEXT_P], [TEXT_P_1], [TEXT_LIST](任意) / 3.[LINK_LIST] / 4.なし / 5.[TEXT], [URL] / 6.[CODE]
					</p>

					<div id="linkItemTemplateSection" style="display: none">
						<label for="linkItemTemplateInput">リンク項目の雛形 (link-list用)</label>
						<textarea id="linkItemTemplateInput" rows="4" placeholder='例: &lt;li&gt;&lt;a href="[URL]"&gt;[TEXT]&lt;/a&gt;&lt;/li&gt;'></textarea>
						<p style="font-size: 0.8em; color: #666; margin-top: -10px">
							※モード3専用：各リンク項目（[TEXT](URL)形式）を個別に変換するテンプレート。[TEXT]と[URL]を使用。
						</p>
					</div>

					<div id="listItemTemplateSection" style="display: none">
						<label for="listItemTemplateInput">リスト項目の雛形 (p-list用)</label>
						<textarea id="listItemTemplateInput" rows="4" placeholder='例: &lt;li&gt;[TEXT]&lt;/li&gt;'></textarea>
						<p style="font-size: 0.8em; color: #666; margin-top: -10px">
							※モード2専用：「-」または「*」で始まる行をリスト項目に変換するテンプレート。[TEXT]を使用。
						</p>
					</div>

					<div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #ddd;">
						<label style="display: flex; align-items: center; font-weight: normal; cursor: pointer;">
							<input type="checkbox" id="removeLastBrInput" style="width: auto; margin-right: 8px;">
							<span>最後の項目から末尾の &lt;br&gt; または &lt;br /&gt; を削除する</span>
						</label>
						<p style="font-size: 0.8em; color: #666; margin-top: 5px; margin-left: 24px;">
							※チェックすると、最後の出力項目のみ末尾の改行タグが削除されます（全モード対応）。
						</p>
					</div>

					<button type="submit">保存</button>
				</form>
			</div>
		</div>

		<!-- エクスポートモーダル -->
		<div id="exportModal" class="modal" role="dialog" aria-labelledby="exportModalTitle" aria-modal="true" aria-hidden="true">
			<div class="modal-content">
				<span class="close export-modal-close" role="button" tabindex="0" aria-label="モーダルを閉じる">&times;</span>
				<h3 id="exportModalTitle">データのエクスポート</h3>
				<form id="exportModalForm">
					<label for="exportPatternSelector">エクスポートするパターンを選択:</label>
					<div id="exportPatternSelector" style="max-height: 200px; overflow-y: auto; border: 1px solid #ccc; padding: 10px; margin-bottom: 15px;">
						<!-- チェックボックスがJSで動的に生成されます -->
					</div>

					<label style="display: flex; align-items: center; margin-bottom: 15px;">
						<input type="checkbox" id="exportAllPatternsCheckbox" style="width: auto; margin-right: 8px;">
						<span>すべてのパターンをエクスポート</span>
					</label>

					<hr style="margin: 20px 0;">

					<label style="display: flex; align-items: center; margin-bottom: 10px;">
						<input type="checkbox" id="exportWithPasswordCheckbox" style="width: auto; margin-right: 8px;">
						<span>パスワードで保護する（推奨）</span>
					</label>

					<div id="exportPasswordSection" style="display: none; margin-left: 24px;">
						<label for="exportPasswordInput">パスワード:</label>
						<input type="password" id="exportPasswordInput" placeholder="8文字以上を推奨" />

						<label for="exportPasswordConfirmInput">パスワード（確認）:</label>
						<input type="password" id="exportPasswordConfirmInput" placeholder="同じパスワードを再入力" />
					</div>

					<button type="submit" style="margin-top: 15px;">💾 エクスポート</button>
				</form>
			</div>
		</div>

		<!-- インポートモーダル -->
		<div id="importModal" class="modal" role="dialog" aria-labelledby="importModalTitle" aria-modal="true" aria-hidden="true">
			<div class="modal-content">
				<span class="close import-modal-close" role="button" tabindex="0" aria-label="モーダルを閉じる">&times;</span>
				<h3 id="importModalTitle">データのインポート</h3>
				<div id="importModalContent">
					<!-- ステップ1: パスワード入力（暗号化されている場合のみ） -->
					<div id="importPasswordSection" style="display: none;">
						<p>このファイルはパスワードで保護されています。</p>
						<label for="importPasswordInput">パスワード:</label>
						<input type="password" id="importPasswordInput" placeholder="パスワードを入力" />
						<button id="importDecryptButton" style="margin-top: 10px;">🔓 復号化して続ける</button>
					</div>

					<!-- ステップ2: インポートオプション選択 -->
					<div id="importOptionsSection" style="display: none;">
						<p style="margin-bottom: 15px;">
							<strong>インポートするパターン:</strong>
						</p>
						<div id="importPatternList" style="max-height: 200px; overflow-y: auto; border: 1px solid #ccc; padding: 10px; margin-bottom: 15px; background-color: #f9f9f9;">
							<!-- パターンリストがJSで表示されます -->
						</div>

						<label style="font-weight: bold; margin-top: 15px; display: block;">インポート方法:</label>
						<label style="display: flex; align-items: center; margin: 10px 0;">
							<input type="radio" name="importMode" value="merge" checked style="width: auto; margin-right: 8px;">
							<span>マージ（既存のデータと統合、同名パターンは上書き）</span>
						</label>
						<label style="display: flex; align-items: center; margin: 10px 0;">
							<input type="radio" name="importMode" value="replace" style="width: auto; margin-right: 8px;">
							<span style="color: red;">置換（すべての既存データを削除して上書き）</span>
						</label>

						<button id="importExecuteButton" style="margin-top: 15px;">✅ インポート実行</button>
					</div>
				</div>
			</div>
		</div>

	</body>
	<script src="script.js"></script>
</html>
