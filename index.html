<!DOCTYPE html>
<html lang="ja">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>ã‚¿ã‚°ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¤‰æ›ã‚¨ãƒ‡ã‚£ã‚¿ (ã‚«ã‚¹ã‚¿ãƒ ã‚¿ã‚°å¯¾å¿œ)</title>
		<style>
			/* ã‚µã‚¤ãƒˆå…¨ä½“ã®å¹…ã‚’1200pxã«å›ºå®šã—ã€ä¸­å¤®å¯„ã›ã«ã™ã‚‹ */
			body {
				max-width: 1200px;
				margin: 0 auto;
				padding: 20px;
				box-sizing: border-box;
				font-family: sans-serif;
				font-size: 16px;
			}

			/* å¤‰æ›ãƒ‘ã‚¿ãƒ¼ãƒ³è¨­å®šã‚¨ãƒªã‚¢ã®ã‚¹ã‚¿ã‚¤ãƒ« */

			.pattern-selector {
				margin-bottom: 10px;
			}

			/* ãƒ‘ã‚¿ãƒ¼ãƒ³ç®¡ç†ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã®ã‚¹ã‚¿ã‚¤ãƒ« */
			#patternManagement {
				border: 1px solid #ccc;
				padding: 10px;
				margin-top: 15px;
				margin-bottom: 10px;
				background-color: #f9f9f9;
				display: flex;
				gap: 10px;
				align-items: center;
			}
			#patternManagement button {
				padding: 8px 12px;
				font-size: 0.9em;
				min-height: 36px;
				display: inline-flex;
				align-items: center;
				justify-content: center;
			}

			.pattern-selector label {
				display: inline-block;
				margin-right: 20px;
				font-weight: bold;
			}
			/* å…¥åŠ›ã‚¨ãƒªã‚¢ã®ã‚°ãƒ«ãƒ¼ãƒ—ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆé«˜ã•çµ±ä¸€ï¼‰ */
			.input-area-group {
				display: flex;
				align-items: stretch;
				margin-bottom: 10px;
			}
			.input-area-group textarea {
				flex-grow: 1;
				width: 100%;
				min-width: 0;
				padding: 8px;
				border: 1px solid #ccc;
				border-radius: 4px;
				font-family: inherit;
				font-size: 1em;
				box-sizing: border-box;
			}
			.input-area-group button {
				flex-shrink: 0;
				margin-left: 10px;
				padding: 5px 15px;
				align-self: flex-start;
			}

			/* ã‚¿ã‚°ç¨®åˆ¥ãƒ©ãƒ™ãƒ«ã®ã‚¹ã‚¿ã‚¤ãƒ« */
			.input-label-tag {
				flex-shrink: 0;
				width: 120px;
				padding: 8px;
				margin-right: 10px;
				background-color: #f4f4f4;
				border: 1px solid #ccc;
				color: #333;
				font-size: 1em;
				font-weight: normal;
				text-align: center;
				align-self: stretch;
				display: flex;
				align-items: center;
				justify-content: center;
				white-space: pre-wrap;
				flex-direction: column;
				line-height: 1.3;
			}

			/* ãƒŠãƒ³ãƒãƒ¼éƒ¨åˆ†ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’æ¨™æº–ã‚µã‚¤ã‚º (1em)ãƒ»å¤ªå­—è§£é™¤ (normal) ã«è¨­å®š */
			.input-label-tag .number-prefix {
				font-size: 1em;
				font-weight: normal;
				margin-bottom: 4px;
			}

			/* æŒ¿å…¥ä½ç½®ã‚»ãƒ¬ã‚¯ã‚¿ã®ã‚¹ã‚¿ã‚¤ãƒ« */
			#insertionPointControls {
				margin-top: 15px;
				margin-bottom: 15px;
				padding: 10px;
				border: 1px solid #eee;
				background-color: #f9f9f9;
			}
			#insertionPointControls label {
				font-weight: bold;
				margin-right: 10px;
			}
			#insertionPointSelector {
				padding: 5px;
				border: 1px solid #ccc;
				border-radius: 4px;
				min-width: 300px;
			}
			/* ã‚¿ã‚°è¿½åŠ ãƒœã‚¿ãƒ³ç¾¤ */
			.tag-buttons button {
				margin-right: 10px;
				margin-bottom: 5px;
			}

			/* --- ã‚¿ã‚°ç®¡ç†ã‚¨ãƒªã‚¢ --- */
			#tagButtonManagement {
				border: 1px solid #ccc;
				padding: 10px;
				margin-bottom: 15px;
				background-color: #f5f5f5;
			}
			/* --- ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆç®¡ç†ã‚¨ãƒªã‚¢ --- */
			#shortcutManagement {
				border: 1px solid #ccc;
				padding: 10px;
				margin-bottom: 15px;
				background-color: #f5f5f5;
			}
			#shortcutManagement button {
				margin-bottom: 10px;
			}
			#shortcutList {
				max-height: 300px;
				overflow-y: auto;
				margin-top: 10px;
				padding: 5px;
				border: 1px solid #ddd;
				background-color: white;
			}
			.shortcut-item {
				display: flex;
				align-items: center;
<<<<<<< HEAD
				padding: 5px;
=======
				padding: 8px;
				margin-bottom: 5px;
>>>>>>> 5aa15c27d6e94bdb5a93affd85868566afc16704
				border-bottom: 1px dotted #eee;
			}
			.shortcut-item:last-child {
				border-bottom: none;
			}
			.shortcut-item label {
				flex-shrink: 0;
				width: 100px;
				font-weight: bold;
				font-size: 0.9em;
				margin-right: 8px;
				overflow: hidden;
				text-overflow: ellipsis;
				white-space: nowrap;
			}
			.shortcut-item select,
			.shortcut-item input[type="text"] {
				flex-grow: 1;
				padding: 5px;
				border: 1px solid #ccc;
				border-radius: 4px;
				font-size: 1em;
			}
			.shortcut-item button {
				flex-shrink: 0;
				margin-left: 8px;
				padding: 5px 8px;
				font-size: 0.85em;
			}
			/* ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ */
			@media (max-width: 768px) {
				body {
					padding: 10px;
					font-size: 14px;
				}
				.shortcut-item {
					padding: 5px;
				}
				.shortcut-item label {
					width: 70px;
					font-size: 0.75em;
					margin-right: 4px;
					line-height: 1.2;
				}
				.shortcut-item input[type="text"] {
					padding: 4px;
					font-size: 0.85em;
					min-width: 0;
				}
				.shortcut-item button {
					margin-left: 4px;
					padding: 4px 6px;
					font-size: 0.75em;
				}
				#shortcutManagement {
					padding: 8px;
				}
			}
			#tagButtonList {
				max-height: 200px;
				overflow-y: auto;
				margin-top: 10px;
				padding: 5px;
				border: 1px solid #ddd;
				background-color: white;
			}
			.tag-item {
				display: flex;
				align-items: center;
				padding: 5px;
				border-bottom: 1px dotted #eee;
			}
			.tag-item:last-child {
				border-bottom: none;
			}
			.tag-item span {
				flex-grow: 1;
				margin-right: 10px;
				font-family: monospace;
			}
			.tag-item button {
				margin-left: 5px;
			}
			/* ãƒ¢ãƒ¼ãƒ€ãƒ« */
			.modal {
				display: none;
				position: fixed;
				z-index: 1000;
				left: 0;
				top: 0;
				width: 100%;
				height: 100%;
				overflow: auto;
				background-color: rgba(0, 0, 0, 0.4);
			}
			.modal-content {
				background-color: #fefefe;
				margin: 10% auto;
				padding: 20px;
				border: 1px solid #888;
				width: 80%;
				max-width: 500px;
				border-radius: 8px;
				position: relative;
			}
			.close {
				color: #aaa;
				float: right;
				font-size: 28px;
				font-weight: bold;
			}
			.close:hover,
			.close:focus {
				color: #000;
				text-decoration: none;
				cursor: pointer;
			}
			#tagModalForm label,
			#shortcutModalForm label {
				display: block;
				margin-top: 10px;
				font-weight: bold;
			}
			#tagModalForm input[type="text"],
			#tagModalForm select,
			#tagModalForm textarea,
			#shortcutModalForm input[type="text"] {
				width: 95%;
				padding: 8px;
				margin: 5px 0 15px 0;
				display: inline-block;
				border: 1px solid #ccc;
				border-radius: 4px;
				box-sizing: border-box;
			}
			#shortcutModalForm button[type="submit"] {
				margin-top: 10px;
			}
			#shortcutModalForm p {
				margin-top: 0;
				margin-bottom: 15px;
				line-height: 1.4;
			}

			/* å‡ºåŠ›ã‚¨ãƒªã‚¢ã®ã‚¹ã‚¿ã‚¤ãƒ« */
			#outputContainer {
				margin-top: 20px;
			}
			#outputContainer pre {
				background-color: #f5f5f5;
				border: 1px solid #ddd;
				border-radius: 4px;
				padding: 15px;
				max-width: 100%;
				overflow-x: auto;
				white-space: pre-wrap;
				word-wrap: break-word;
				word-break: break-all;
			}
			#outputContainer code {
				font-family: "Courier New", Courier, monospace;
				font-size: 0.9em;
				line-height: 1.5;
			}
		</style>
	</head>
	<body>
		<!-- å¤‰æ›ãƒ‘ã‚¿ãƒ¼ãƒ³è¨­å®šã‚¨ãƒªã‚¢ -->
		<h2>å¤‰æ›ãƒ‘ã‚¿ãƒ¼ãƒ³è¨­å®š</h2>

		<div id="patternSelectorContainer" class="pattern-selector">
			<!-- ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ã¯JSã§å‹•çš„ã«ç”Ÿæˆã•ã‚Œã¾ã™ -->
		</div>

		<!-- ãƒ‘ã‚¿ãƒ¼ãƒ³ç®¡ç†ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« -->
		<div id="patternManagement">
			<button id="addPatternButton">â• æ–°ã—ã„ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è¿½åŠ </button>
			<button id="renamePatternButton">âœï¸ ãƒ‘ã‚¿ãƒ¼ãƒ³åã‚’å¤‰æ›´</button>
			<button id="deletePatternButton" disabled style="color: red">ğŸ—‘ï¸ ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å‰Šé™¤</button>
		</div>

		<hr />

		<!-- æ–°ã—ã„ã‚¿ã‚°ãƒœã‚¿ãƒ³ç®¡ç†ã‚¨ãƒªã‚¢ -->
		<h2>ã‚¿ã‚°ãƒœã‚¿ãƒ³ç®¡ç†</h2>
		<div id="tagButtonManagement">
			<p style="font-size: 0.9em; margin-bottom: 10px">
				â€»é¸æŠä¸­ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ç´ã¥ã<strong>ã‚¿ã‚°ãƒœã‚¿ãƒ³</strong>ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã¾ã™ã€‚
			</p>
			<button id="addNewTagButton">â• æ–°ã—ã„ã‚¿ã‚°ãƒœã‚¿ãƒ³ã‚’è¿½åŠ </button>
			<div id="tagButtonList">
				<!-- æ—¢å­˜ã®ã‚¿ã‚°ãƒœã‚¿ãƒ³ãŒJSã§ã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
			</div>
		</div>

		<hr />

		<!-- ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚­ãƒ¼ç®¡ç†ã‚¨ãƒªã‚¢ -->
		<h2>ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚­ãƒ¼ç®¡ç†</h2>
		<div id="shortcutManagement">
			<p style="font-size: 0.9em; margin-bottom: 10px">
				â€»ãƒ†ã‚­ã‚¹ãƒˆé¸æŠæ™‚ã«ä½¿ãˆã‚‹ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚­ãƒ¼ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã¾ã™ã€‚
			</p>
			<button id="addNewShortcutButton">â• æ–°ã—ã„ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚’è¿½åŠ </button>
			<div id="shortcutList">
				<!-- ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆè¨­å®šãŒJSã§ã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
			</div>
		</div>

		<hr />

		<!-- å…¥åŠ›ã‚¨ãƒªã‚¢ -->
		<h2>å…¥åŠ›ã‚¨ãƒªã‚¢</h2>
		<div id="container"></div>

		<!-- æŒ¿å…¥ä½ç½®ã‚»ãƒ¬ã‚¯ã‚¿ -->
		<div id="insertionPointControls">
			<label for="insertionPointSelector">æŒ¿å…¥ä½ç½®ã‚’é¸æŠ:</label>
			<select id="insertionPointSelector">
				<!-- ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯JavaScriptã§å‹•çš„ã«ç”Ÿæˆã•ã‚Œã¾ã™ -->
			</select>
			<p style="font-size: 0.8em; color: #666; margin-top: 5px">
				â€»é¸æŠã—ãŸã‚¨ãƒªã‚¢ã®<strong>ç›´å¾Œ</strong>ã«æ–°ã—ã„ã‚¿ã‚°ãŒæŒ¿å…¥ã•ã‚Œã¾ã™ã€‚ã€Œ<strong>ãƒªã‚¹ãƒˆã®å…ˆé ­</strong>ã€ã‚’é¸æŠã™ã‚‹ã¨ã€ä¸€ç•ªä¸Šã«è¿½åŠ ã•ã‚Œã¾ã™ã€‚
			</p>
		</div>

		<!-- ã‚¿ã‚°è¿½åŠ ãƒœã‚¿ãƒ³ç¾¤ (JSã§å‹•çš„ã«å†ç”Ÿæˆã•ã‚Œã¾ã™) -->
		<div id="tagButtonsContainer" class="tag-buttons">
			<!-- å‹•çš„ãªãƒœã‚¿ãƒ³ãŒã“ã“ã«è¿½åŠ ã•ã‚Œã¾ã™ -->
		</div>
		<p style="font-size: 0.9em; margin-top: 10px">
			â€»ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚­ãƒ¼ã¯ä¸Šã®ã€Œã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚­ãƒ¼ç®¡ç†ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§ãã¾ã™ã€‚
		</p>

		<hr />

		<!-- ä¸€æ‹¬å¤‰æ›ãƒœã‚¿ãƒ³ -->
		<h2>HTMLã‚³ãƒ¼ãƒ‰å‡ºåŠ›</h2>
		<button id="convertToAllButton">ã™ã¹ã¦ã‚’ä¸€æ‹¬å¤‰æ›ã—ã¦è¿½è¨˜</button>

		<div id="outputContainer">
			<h3>å¤‰æ›ã•ã‚ŒãŸHTMLã‚³ãƒ¼ãƒ‰</h3>
			<pre><code id="htmlCodeOutput"></code></pre>

			<!-- ã‚³ãƒ”ãƒ¼ãƒœã‚¿ãƒ³ -->
			<button id="copyOutputButton">ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼</button>
			<button id="clearOutputButton">çµæœã‚’ã‚¯ãƒªã‚¢</button>
		</div>

		<!-- ã‚¿ã‚°è¿½åŠ /ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
		<div id="tagModal" class="modal">
			<div class="modal-content">
				<span class="close">&times;</span>
				<h3 id="modalTitle">æ–°ã—ã„ã‚¿ã‚°ãƒœã‚¿ãƒ³ã®è¿½åŠ </h3>
				<form id="tagModalForm">
					<input type="hidden" id="tagIdInput" />

					<label for="tagNameInput">ãƒœã‚¿ãƒ³å (ä¾‹: å¤§è¦‹å‡ºã—, å¤–éƒ¨ãƒªãƒ³ã‚¯, æ )</label>
					<input type="text" id="tagNameInput" required />

					<label for="tagTypeSelector">ã‚¿ã‚°ã‚¿ã‚¤ãƒ— (å‹•ä½œãƒ¢ãƒ¼ãƒ‰)</label>
					<select id="tagTypeSelector">
						<option value="single">[TEXT]ç½®æ› (P, H, BOXãªã©)</option>
						<option value="list">[TEXT]ç½®æ› (UL, OLãªã©ã€‚å„è¡ŒãŒLIã«)</option>
						<option value="link">[TEXT]ã¨[URL]ç½®æ› (ãƒªãƒ³ã‚¯ç³»ã€‚2è¡Œå…¥åŠ›)</option>
						<option value="p-list">[TEXT_P]ã¨[TEXT_LIST]ç½®æ› (P+UL/OLç³»ã€‚è¤‡æ•°è¡Œå…¥åŠ›)</option>
						<option value="link-list">
							[TEXT]ã¨[URL]ã§ç¹°ã‚Šè¿”ã— (è¤‡æ•°ãƒªãƒ³ã‚¯ã®ãƒªã‚¹ãƒˆã€‚äº¤äº’ã«å…¥åŠ›)
						</option>
					</select>
					<p style="font-size: 0.8em; color: #666; margin-top: -10px">
						â€»å…¥åŠ›ã‚¨ãƒªã‚¢ã®å‹•ä½œï¼ˆè¤‡æ•°è¡Œã®æ‰±ã„ã€URLã®å–å¾—ãªã©ï¼‰ã‚’æ±ºå®šã—ã¾ã™ã€‚
					</p>

					<label for="tagTemplateInput">é››å½¢ (ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ)</label>
					<textarea id="tagTemplateInput" rows="3" placeholder='ä¾‹: &lt;p class="custom"&gt;[TEXT]&lt;/p&gt;'></textarea>
					<p style="font-size: 0.8em; color: #666; margin-top: -10px">
						â€»ã‚¿ã‚°ã‚¿ã‚¤ãƒ—ã«åˆã‚ã›ã¦ã€[TEXT], [URL], [TEXT_P], [TEXT_LIST], [LINK_LIST] ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚
					</p>

					<div id="linkItemTemplateSection" style="display: none">
						<label for="linkItemTemplateInput">ãƒªãƒ³ã‚¯é …ç›®ã®é››å½¢ (link-listç”¨)</label>
						<textarea id="linkItemTemplateInput" rows="2" placeholder='ä¾‹: &lt;li class="rtoc-item"&gt;&lt;a href="[URL]"&gt;[TEXT]&lt;/a&gt;&lt;/li&gt;'></textarea>
						<p style="font-size: 0.8em; color: #666; margin-top: -10px">
							â€»ç¹°ã‚Šè¿”ã•ã‚Œã‚‹å„ãƒªãƒ³ã‚¯é …ç›®ã®å½¢å¼ã‚’ [URL] ã¨ [TEXT] ã‚’ä½¿ã£ã¦å®šç¾©ã—ã¾ã™ã€‚
						</p>
					</div>

					<button type="submit">ä¿å­˜</button>
				</form>
			</div>
		</div>

		<!-- ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆè¿½åŠ ãƒ¢ãƒ¼ãƒ€ãƒ« -->
		<div id="shortcutModal" class="modal">
			<div class="modal-content">
				<span class="close" id="closeShortcutModal">&times;</span>
				<h3>æ–°ã—ã„ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚­ãƒ¼ã®è¿½åŠ </h3>
				<form id="shortcutModalForm">
					<label for="shortcutKeyInput">ã‚­ãƒ¼ (A-Z ã®1æ–‡å­—)</label>
					<input type="text" id="shortcutKeyInput" maxlength="1" required placeholder="ä¾‹: G, I, Pãªã©" />
					<p style="font-size: 0.85em; color: #666">
						â€»Ctrl/Cmd ã¨çµ„ã¿åˆã‚ã›ã¦ä½¿ç”¨ã—ã¾ã™ã€‚A-Zã®è‹±å­—1æ–‡å­—ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚
					</p>

					<label for="shortcutTagInput">ã‚¿ã‚°å</label>
					<input type="text" id="shortcutTagInput" required placeholder="ä¾‹: code, span, div" />
					<p style="font-size: 0.85em; color: #666">
						â€»é¸æŠãƒ†ã‚­ã‚¹ãƒˆã‚’å›²ã‚€HTMLã‚¿ã‚°åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚
					</p>

					<button type="submit">è¿½åŠ </button>
				</form>
			</div>
		</div>
	</body>
	<script>
		document.addEventListener("DOMContentLoaded", function () {
			// --- è¦ç´ ã®å–å¾— ---
			const convertAllButton = document.getElementById("convertToAllButton");
			const clearOutputButton = document.getElementById("clearOutputButton");
			const copyOutputButton = document.getElementById("copyOutputButton");
			const container = document.getElementById("container");
			const insertionPointSelector = document.getElementById("insertionPointSelector");
			const htmlCodeOutput = document.getElementById("htmlCodeOutput");

			const patternSelectorContainer = document.getElementById("patternSelectorContainer");
			const addPatternButton = document.getElementById("addPatternButton");
			const renamePatternButton = document.getElementById("renamePatternButton");
			const deletePatternButton = document.getElementById("deletePatternButton");
			const tagButtonsContainer = document.getElementById("tagButtonsContainer"); // æ–°ã—ã„ãƒœã‚¿ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ

			// ã‚¿ã‚°ç®¡ç†é–¢é€£
			const addNewTagButton = document.getElementById("addNewTagButton");
			const tagButtonList = document.getElementById("tagButtonList");
			const tagModal = document.getElementById("tagModal");
			const modalTitle = document.getElementById("modalTitle");
			const tagModalForm = document.getElementById("tagModalForm");
			const tagIdInput = document.getElementById("tagIdInput");
			const tagNameInput = document.getElementById("tagNameInput");
			const tagTypeSelector = document.getElementById("tagTypeSelector");
			const tagTemplateInput = document.getElementById("tagTemplateInput");
			const linkItemTemplateSection = document.getElementById("linkItemTemplateSection");
			const linkItemTemplateInput = document.getElementById("linkItemTemplateInput");
			const closeModalSpan = tagModal.querySelector(".close");

			// ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆç®¡ç†é–¢é€£
			const shortcutList = document.getElementById("shortcutList");
			const addNewShortcutButton = document.getElementById("addNewShortcutButton");
			const shortcutModal = document.getElementById("shortcutModal");
			const shortcutModalForm = document.getElementById("shortcutModalForm");
			const shortcutKeyInput = document.getElementById("shortcutKeyInput");
			const shortcutTagInput = document.getElementById("shortcutTagInput");
			const closeShortcutModalSpan = document.getElementById("closeShortcutModal");

			let areaIndex = 0;
			let maxPatternId = 0;
			let maxTagId = 0;

			// --- é››å½¢è¨­å®šã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ‡ãƒ¼ã‚¿ï¼ˆæ§‹é€ å¤‰æ›´ï¼‰ ---
			const defaultTagButtons = [
				// id, name, template, tagType (single, list, link, p-list)
				{ id: "p", name: "pã‚¿ã‚°", template: "<p>[TEXT]</p>", tagType: "single" },
				{ id: "h2", name: "h2ã‚¿ã‚°", template: "<h2>[TEXT]</h2>", tagType: "single" },
				{
					id: "a-int",
					name: "å†…éƒ¨ãƒªãƒ³ã‚¯",
					template: '<a href="[URL]">[TEXT]</a>',
					tagType: "link",
				},
				{
					id: "a-ext",
					name: "å¤–éƒ¨ãƒªãƒ³ã‚¯",
					template: '<a href="[URL]" target="_blank">[TEXT]</a>',
					tagType: "link",
				},
				{ id: "ul", name: "ULã‚¿ã‚°", template: "<ul>\n[TEXT]\n</ul>", tagType: "list" },
				{ id: "box", name: "æ ", template: '<div class="box">\n[TEXT]\n</div>', tagType: "single" },
				{
					id: "box-p-ul",
					name: "ç®‡æ¡æ›¸ããƒªã‚¹ãƒˆ",
					template: '<div class="box"><p>[TEXT_P]</p><ul>\n[TEXT_LIST]\n</ul></div>',
					tagType: "p-list",
				},
			];

			const defaultPatterns = {
				pattern1: {
					name: "ã‚½ãƒ‹ãƒ¼ (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ)",
					buttons: JSON.parse(JSON.stringify(defaultTagButtons)), // ãƒ‡ã‚£ãƒ¼ãƒ—ã‚³ãƒ”ãƒ¼
					shortcuts: {
						B: { tag: "strong", displayName: "Ctrl/Cmd+B" },
						M: { tag: "mark", displayName: "Ctrl/Cmd+M" },
						U: { tag: "sup", displayName: "Ctrl/Cmd+U" },
						L: { tag: "li", displayName: "Ctrl/Cmd+L" },
						K: { tag: "a", displayName: "Ctrl/Cmd+K" },
					},
				},
				pattern2: {
					name: "ã‚«ã‚¹ã‚¿ãƒ ä¾‹",
					buttons: [
						{
							id: "p-red",
							name: "èµ¤æ–‡å­—P",
							template: '<p style="color:red;">[TEXT]</p>',
							tagType: "single",
						},
						{
							id: "h2-border",
							name: "ä¸‹ç·šH2",
							template: '<h2 style="border-bottom: 2px solid black;">[TEXT]</h2>',
							tagType: "single",
						},
						{
							id: "note",
							name: "æ³¨æ„æ ",
							template:
								'<div class="note" style="border: 1px solid red; padding: 10px;">\n<p style="font-weight: bold;">æ³¨æ„ï¼š</p>\n[TEXT]\n</div>',
							tagType: "single",
						},
					],
					shortcuts: {
						B: { tag: "strong", displayName: "Ctrl/Cmd+B" },
						M: { tag: "mark", displayName: "Ctrl/Cmd+M" },
						U: { tag: "sup", displayName: "Ctrl/Cmd+U" },
						L: { tag: "li", displayName: "Ctrl/Cmd+L" },
						K: { tag: "a", displayName: "Ctrl/Cmd+K" },
					},
				},
			};

			let patterns = {}; // ã™ã¹ã¦ã®ãƒ‘ã‚¿ãƒ¼ãƒ³è¨­å®šã‚’ä¿æŒã™ã‚‹ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ

			// --- æ°¸ç¶šåŒ–ã¨åˆæœŸåŒ– ---
			const STORAGE_KEY = "customTagPatternsV2";
			const SETTINGS_KEY = "editorSettingsV2";
			const SHORTCUTS_KEY = "keyboardShortcutsV2";

			// ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆè¨­å®š
			const defaultShortcuts = {
				B: { tag: "strong", displayName: "Ctrl/Cmd+B" },
				M: { tag: "mark", displayName: "Ctrl/Cmd+M" },
				U: { tag: "sup", displayName: "Ctrl/Cmd+U" },
				L: { tag: "li", displayName: "Ctrl/Cmd+L" },
				K: { tag: "a", displayName: "Ctrl/Cmd+K" },
			};

			let keyboardShortcuts = {};

			const saveAllPatterns = () => {
				const selectedId = getSelectedPatternId();

				localStorage.setItem(STORAGE_KEY, JSON.stringify(patterns));

				const settings = {
					selectedPattern: selectedId,
				};
				localStorage.setItem(SETTINGS_KEY, JSON.stringify(settings));
			};

			const saveShortcuts = () => {
<<<<<<< HEAD
				const patternId = getSelectedPatternId();
				const currentPattern = patterns[patternId];

				if (currentPattern) {
					currentPattern.shortcuts = keyboardShortcuts;
					saveAllPatterns(); // ãƒ‘ã‚¿ãƒ¼ãƒ³å…¨ä½“ã‚’ä¿å­˜
				}
			};

			const loadShortcuts = () => {
				const patternId = getSelectedPatternId();
				const currentPattern = patterns[patternId];

				if (currentPattern && currentPattern.shortcuts) {
					keyboardShortcuts = currentPattern.shortcuts;
				} else {
					// ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼šãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆãŒãªã„å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚’è¨­å®š
					keyboardShortcuts = JSON.parse(JSON.stringify(defaultShortcuts));
					if (currentPattern) {
						currentPattern.shortcuts = keyboardShortcuts;
					}
=======
				localStorage.setItem(SHORTCUTS_KEY, JSON.stringify(keyboardShortcuts));
			};

			const loadShortcuts = () => {
				const savedShortcuts = localStorage.getItem(SHORTCUTS_KEY);
				if (savedShortcuts) {
					try {
						keyboardShortcuts = JSON.parse(savedShortcuts);
					} catch (e) {
						keyboardShortcuts = JSON.parse(JSON.stringify(defaultShortcuts));
					}
				} else {
					keyboardShortcuts = JSON.parse(JSON.stringify(defaultShortcuts));
>>>>>>> 5aa15c27d6e94bdb5a93affd85868566afc16704
				}
			};

			// ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆç®¡ç†UIã®æ§‹ç¯‰
			const buildShortcutUI = () => {
				const shortcutList = document.getElementById("shortcutList");
				if (!shortcutList) return;

				shortcutList.innerHTML = "";

				Object.keys(keyboardShortcuts).forEach((key) => {
					const shortcut = keyboardShortcuts[key];
					const item = document.createElement("div");
					item.className = "shortcut-item";

					const label = document.createElement("label");
					label.textContent = shortcut.displayName;

					const input = document.createElement("input");
					input.type = "text";
					input.value = shortcut.tag;
					input.placeholder = "ã‚¿ã‚°åã‚’å…¥åŠ› (ä¾‹: strong, mark, code)";

					input.addEventListener("input", (e) => {
						keyboardShortcuts[key].tag = e.target.value.trim();
						saveShortcuts();
					});

					const deleteButton = document.createElement("button");
					deleteButton.textContent = "å‰Šé™¤";
					deleteButton.style.color = "red";
					deleteButton.addEventListener("click", () => {
<<<<<<< HEAD
						if (confirm(`ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã€Œ${shortcut.displayName}ã€ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ`)) {
=======
						if (true) {
							// TODO: ã‚«ã‚¹ã‚¿ãƒ ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ«æ¨å¥¨
>>>>>>> 5aa15c27d6e94bdb5a93affd85868566afc16704
							console.log(`ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã€Œ${shortcut.displayName}ã€ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚`);
							delete keyboardShortcuts[key];
							buildShortcutUI();
							saveShortcuts();
						}
					});

					item.appendChild(label);
					item.appendChild(input);
					item.appendChild(deleteButton);
					shortcutList.appendChild(item);
				});
			};

			const loadAllPatterns = () => {
				const savedPatterns = localStorage.getItem(STORAGE_KEY);
				if (savedPatterns) {
					try {
						patterns = JSON.parse(savedPatterns);
						if (Object.keys(patterns).length === 0) {
							patterns = defaultPatterns;
						}

						// IDã®æœ€å¤§å€¤ã‚’æ›´æ–°
						Object.keys(patterns).forEach((id) => {
							const num = parseInt(id.replace("pattern", ""));
							if (!isNaN(num)) {
								maxPatternId = Math.max(maxPatternId, num);
							}
							// ã‚¿ã‚°IDã®æœ€å¤§å€¤ã‚‚æ›´æ–°
							patterns[id].buttons.forEach((button) => {
								if (button.id.startsWith("custom")) {
									const tagNum = parseInt(button.id.replace("custom", ""));
									if (!isNaN(tagNum)) {
										maxTagId = Math.max(maxTagId, tagNum);
									}
								}
							});
							// å¾Œæ–¹äº’æ›æ€§ï¼šã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆãŒãªã„å¤ã„ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚’è¿½åŠ 
							if (!patterns[id].shortcuts) {
								patterns[id].shortcuts = JSON.parse(JSON.stringify(defaultShortcuts));
							}
						});
					} catch (e) {
						patterns = defaultPatterns;
					}
				} else {
					patterns = defaultPatterns;
				}

				const savedSettings = localStorage.getItem(SETTINGS_KEY);
				let initialSelectedPattern = "pattern1";
				if (savedSettings) {
					try {
						const settings = JSON.parse(savedSettings);
						initialSelectedPattern = settings.selectedPattern || "pattern1";
					} catch (e) {
						// do nothing
					}
				}

				rebuildPatternUI(initialSelectedPattern);
				rebuildTagButtons(); // ã‚¿ã‚°ãƒœã‚¿ãƒ³ç¾¤ã‚‚åˆæœŸåŒ–æ™‚ã«ç”Ÿæˆ
				updateInsertionPoints(); // å…¥åŠ›ã‚¨ãƒªã‚¢ã®ãƒªã‚¹ãƒˆã‚’æ›´æ–°
			};

			// --- UIæ§‹ç¯‰ã¨ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½ ---
			const getSelectedPatternId = () => {
				const checked = document.querySelector('input[name="conversionPattern"]:checked');
				return checked ? checked.value : Object.keys(patterns)[0];
			};

			const rebuildPatternUI = (initialSelectedId) => {
				patternSelectorContainer.innerHTML = "";

				let firstId = null;
				let selectedId = initialSelectedId;

				Object.keys(patterns).forEach((id, index) => {
					if (index === 0) firstId = id;
					const pattern = patterns[id];

					// 1. ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ã®ç”Ÿæˆ
					const label = document.createElement("label");
					const input = document.createElement("input");
					input.type = "radio";
					input.name = "conversionPattern";
					input.id = id;
					input.value = id;
					input.addEventListener("change", () => {
						rebuildTagButtons(); // ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ‡ã‚Šæ›¿ãˆæ™‚ã€ãƒœã‚¿ãƒ³ã‚’å†ç”Ÿæˆ
						rebuildTagButtonList(); // ã‚¿ã‚°ãƒœã‚¿ãƒ³ç®¡ç†ä¸€è¦§ã‚’æ›´æ–°
						loadShortcuts(); // ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚’å†èª­ã¿è¾¼ã¿
						buildShortcutUI(); // ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆUIã‚’å†æ§‹ç¯‰
						saveAllPatterns();
					});

					const nameSpan = document.createElement("span");
					nameSpan.id = `label-name-${id}`;
					nameSpan.textContent = pattern.name;

					label.appendChild(input);
					label.appendChild(nameSpan);
					patternSelectorContainer.appendChild(label);
				});

				// 3. åˆæœŸé¸æŠã¨è¡¨ç¤ºçŠ¶æ…‹ã®è¨­å®š
				const finalSelectedId = patterns[selectedId] ? selectedId : firstId;
				if (finalSelectedId) {
					const selectedRadio = document.getElementById(finalSelectedId);
					if (selectedRadio) {
						selectedRadio.checked = true;
					}
				}

				updateDeleteButtonState();
			};

			// å‰Šé™¤ãƒœã‚¿ãƒ³ã® disabled çŠ¶æ…‹ã‚’æ›´æ–°
			const updateDeleteButtonState = () => {
				const count = Object.keys(patterns).length;
				deletePatternButton.disabled = count <= 1;
			};

			// --- ãƒ‘ã‚¿ãƒ¼ãƒ³ç®¡ç†ãƒœã‚¿ãƒ³ã®æ©Ÿèƒ½ ---

			addPatternButton.addEventListener("click", () => {
				maxPatternId++;
				const newId = `pattern${maxPatternId}`;
				const newName = `æ–°ã—ã„ãƒ‘ã‚¿ãƒ¼ãƒ³ ${maxPatternId}`;

				// â˜…â˜…â˜… ä¿®æ­£ç®‡æ‰€ â˜…â˜…â˜…
				// æ—¢å­˜ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ãƒœã‚¿ãƒ³å®šç¾©ã‚’ãƒ‡ã‚£ãƒ¼ãƒ—ã‚³ãƒ”ãƒ¼ï¼ˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚‚ãã®ã¾ã¾ã‚³ãƒ”ãƒ¼ï¼‰
				const sourcePattern = patterns[getSelectedPatternId()] || patterns[Object.keys(patterns)[0]];

				patterns[newId] = {
					name: newName,
					// ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ(template)ã‚‚ãã®ã¾ã¾ã‚³ãƒ”ãƒ¼ã™ã‚‹ã‚ˆã†ã«ä¿®æ­£
					buttons: JSON.parse(
						JSON.stringify(
							sourcePattern.buttons.map((b) => ({
								id: b.id,
								name: b.name,
								template: b.template, // ä¿®æ­£: '' ã§ã¯ãªã b.template ã‚’ã‚³ãƒ”ãƒ¼
								tagType: b.tagType,
								linkItemTemplate: b.linkItemTemplate || "", // linkItemTemplateã‚‚ã‚³ãƒ”ãƒ¼
							}))
						)
					),
					// ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚‚ã‚³ãƒ”ãƒ¼
					shortcuts: JSON.parse(JSON.stringify(sourcePattern.shortcuts || defaultShortcuts)),
				};

				rebuildPatternUI(newId);
				rebuildTagButtons();
				rebuildTagButtonList();
				loadShortcuts(); // æ–°ã—ã„ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚’èª­ã¿è¾¼ã¿
				buildShortcutUI(); // ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆUIã‚’å†æ§‹ç¯‰
				saveAllPatterns();
			});

			renamePatternButton.addEventListener("click", () => {
				const selectedId = getSelectedPatternId();
				const currentPattern = patterns[selectedId];
				if (!currentPattern) return;

				const newName = prompt("æ–°ã—ã„ãƒ‘ã‚¿ãƒ¼ãƒ³åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:", currentPattern.name);
				if (newName !== null && newName.trim() !== "") {
					currentPattern.name = newName.trim();
					document.getElementById(`label-name-${selectedId}`).textContent = newName.trim();
					saveAllPatterns();
				}
			});

			deletePatternButton.addEventListener("click", () => {
				const selectedId = getSelectedPatternId();
				if (Object.keys(patterns).length <= 1) {
					// alert("ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯æœ€ä½1ã¤å¿…è¦ã§ã™ã€‚");
					// ã‚¢ãƒ©ãƒ¼ãƒˆã®ä»£ã‚ã‚Šã«ã‚«ã‚¹ã‚¿ãƒ UIã‚„ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã‚’ä½¿ç”¨
					console.warn("ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯æœ€ä½1ã¤å¿…è¦ã§ã™ã€‚");
					return;
				}

				const currentPattern = patterns[selectedId];
				if (confirm(`ãƒ‘ã‚¿ãƒ¼ãƒ³ã€Œ${currentPattern.name}ã€ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ`)) {
					console.log(`ãƒ‘ã‚¿ãƒ¼ãƒ³ã€Œ${currentPattern.name}ã€ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚`);
					delete patterns[selectedId];

					const firstId = Object.keys(patterns)[0];
					rebuildPatternUI(firstId);
					rebuildTagButtons();
					rebuildTagButtonList();
					loadShortcuts(); // æ–°ã—ã„ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚’èª­ã¿è¾¼ã¿
					buildShortcutUI(); // ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆUIã‚’å†æ§‹ç¯‰
					saveAllPatterns();
				}
			});

			// --- ã‚¿ã‚°ãƒœã‚¿ãƒ³ç®¡ç†æ©Ÿèƒ½ ---

			// ãƒ¢ãƒ¼ãƒ€ãƒ«ã®è¡¨ç¤º (è¿½åŠ /ç·¨é›†)
			const openTagModal = (button = null) => {
				tagModal.style.display = "block";
				if (button) {
					// ç·¨é›†ãƒ¢ãƒ¼ãƒ‰
					modalTitle.textContent = "ã‚¿ã‚°ãƒœã‚¿ãƒ³ã®ç·¨é›†";
					tagIdInput.value = button.id;
					tagNameInput.value = button.name;
					tagTypeSelector.value = button.tagType;
					tagTemplateInput.value = button.template;
					linkItemTemplateInput.value = button.linkItemTemplate || '<li class="rtoc-item"><a href="[URL]">[TEXT]</a></li>';
				} else {
					// æ–°è¦è¿½åŠ ãƒ¢ãƒ¼ãƒ‰
					modalTitle.textContent = "æ–°ã—ã„ã‚¿ã‚°ãƒœã‚¿ãƒ³ã®è¿½åŠ ";
					tagIdInput.value = "";
					tagNameInput.value = "";
					tagTypeSelector.value = "single";
					tagTemplateInput.value = "";
					linkItemTemplateInput.value = '<li class="rtoc-item"><a href="[URL]">[TEXT]</a></li>';
				}

				// â˜…â˜…â˜… ä¿®æ­£ç®‡æ‰€ â˜…â˜…â˜…
				// ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºæ™‚ã«ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã‚’æ›´æ–°
				updateTemplatePlaceholder();
				// â˜…â˜…â˜… ä¿®æ­£ç®‡æ‰€ã“ã“ã¾ã§ â˜…â˜…â˜…
			};

			// ãƒ¢ãƒ¼ãƒ€ãƒ«ã®é–‰ã˜ã‚‹å‡¦ç†
			closeModalSpan.onclick = function () {
				tagModal.style.display = "none";
			};
			// å¤–å´ã‚¯ãƒªãƒƒã‚¯ã§ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹æ©Ÿèƒ½ã¯ç„¡åŠ¹åŒ–ï¼ˆèª¤æ“ä½œé˜²æ­¢ã®ãŸã‚ï¼‰
			// window.onclick = function (event) {
			// 	if (event.target == tagModal) {
			// 		tagModal.style.display = "none";
			// 	}
			// };

			// ã€Œæ–°ã—ã„ã‚¿ã‚°ãƒœã‚¿ãƒ³ã‚’è¿½åŠ ã€ãƒœã‚¿ãƒ³
			addNewTagButton.addEventListener("click", () => openTagModal());

			// --- ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆè¿½åŠ æ©Ÿèƒ½ ---

			// ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
			addNewShortcutButton.addEventListener("click", () => {
				shortcutModal.style.display = "block";
				shortcutKeyInput.value = "";
				shortcutTagInput.value = "";
			});

			// ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
			closeShortcutModalSpan.onclick = function () {
				shortcutModal.style.display = "none";
			};

			// ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆè¿½åŠ ãƒ•ã‚©ãƒ¼ãƒ ã®é€ä¿¡
			shortcutModalForm.addEventListener("submit", (e) => {
				e.preventDefault();

				const key = shortcutKeyInput.value.trim().toUpperCase();
				const tag = shortcutTagInput.value.trim();

				// ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
				if (!/^[A-Z]$/.test(key)) {
					alert("A-Zã®è‹±å­—1æ–‡å­—ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
					return;
				}

				if (!tag) {
					alert("ã‚¿ã‚°åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
					return;
				}

				// æ—¢å­˜ã®ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆãŒã‚ã‚‹å ´åˆã¯ä¸Šæ›¸ãç¢ºèª
				if (keyboardShortcuts[key]) {
					if (!confirm(`Ctrl/Cmd+${key} ã¯æ—¢ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚ä¸Šæ›¸ãã—ã¾ã™ã‹ï¼Ÿ`)) {
						return;
					}
				}

				// ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚’è¿½åŠ 
				keyboardShortcuts[key] = {
					tag: tag,
					displayName: `Ctrl/Cmd+${key}`,
				};

				shortcutModal.style.display = "none";
				buildShortcutUI();
				saveShortcuts();
			});

			// â˜…â˜…â˜… ã“ã“ã‹ã‚‰ä¿®æ­£ç®‡æ‰€ â˜…â˜…â˜…

			// é››å½¢ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã®ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
			const updateTemplatePlaceholder = () => {
				const selectedType = tagTypeSelector.value;
				let placeholder = "";

				// link-listç”¨ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®è¡¨ç¤º/éè¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆ
				if (selectedType === "link-list") {
					linkItemTemplateSection.style.display = "block";
				} else {
					linkItemTemplateSection.style.display = "none";
				}

				switch (selectedType) {
					case "single":
						placeholder = 'ä¾‹: <p class="custom">[TEXT]</p>';
						break;
					case "list":
						placeholder = "ä¾‹:\n<ul>\n[TEXT]\n</ul>\n\nâ€»[TEXT]ã¯å„è¡ŒãŒ<li>...</li>ã«ç½®æ›ã•ã‚Œã¾ã™";
						break;
					case "link":
						placeholder = 'ä¾‹: <a href="[URL]">[TEXT]</a>';
						break;
					case "p-list":
						placeholder = "ä¾‹:\n<div>\n<p>[TEXT_P]</p>\n<ul>\n[TEXT_LIST]\n</ul>\n</div>";
						break;
					case "link-list":
						placeholder = 'ä¾‹:\n<div class="wrapper">\n<ul>\n[LINK_LIST]\n</ul>\n</div>\n\nâ€»[LINK_LIST]ã®ä½ç½®ã«ç¹°ã‚Šè¿”ã•ã‚Œã‚‹ãƒªãƒ³ã‚¯é …ç›®ãŒæŒ¿å…¥ã•ã‚Œã¾ã™';
						break;
					default:
						placeholder = "[TEXT] ã‚’ä½¿ã£ã¦é››å½¢ã‚’å…¥åŠ›";
				}
				tagTemplateInput.placeholder = placeholder;
			};

			// ã‚¿ã‚°ã‚¿ã‚¤ãƒ—ã‚»ãƒ¬ã‚¯ã‚¿ãŒå¤‰æ›´ã•ã‚ŒãŸã‚‰ã€ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã‚’æ›´æ–°
			tagTypeSelector.addEventListener("change", updateTemplatePlaceholder);

			// â˜…â˜…â˜… ä¿®æ­£ç®‡æ‰€ã“ã“ã¾ã§ â˜…â˜…â˜…

			// ã‚¿ã‚°ä¿å­˜ (è¿½åŠ /ç·¨é›†) å‡¦ç†
			tagModalForm.addEventListener("submit", (e) => {
				e.preventDefault();

				const patternId = getSelectedPatternId();
				const currentPattern = patterns[patternId];
				if (!currentPattern) return;

				const existingId = tagIdInput.value;
				const newName = tagNameInput.value.trim();
				const newType = tagTypeSelector.value;
				const newTemplate = tagTemplateInput.value;
				const newLinkItemTemplate = linkItemTemplateInput.value;

				if (existingId) {
					// ç·¨é›†
					const button = currentPattern.buttons.find((b) => b.id === existingId);
					if (button) {
						button.name = newName;
						button.tagType = newType;
						button.template = newTemplate;
						button.linkItemTemplate = newLinkItemTemplate;
					}
				} else {
					// æ–°è¦è¿½åŠ 
					maxTagId++;
					const newId = `custom${maxTagId}`;
					currentPattern.buttons.push({
						id: newId,
						name: newName,
						template: newTemplate,
						tagType: newType,
						linkItemTemplate: newLinkItemTemplate,
					});
				}

				tagModal.style.display = "none";
				rebuildTagButtons();
				rebuildTagButtonList();
				saveAllPatterns();
			});

			// ã‚¿ã‚°ãƒœã‚¿ãƒ³ä¸€è¦§ã®æ§‹ç¯‰
			const rebuildTagButtonList = () => {
				tagButtonList.innerHTML = "";
				const patternId = getSelectedPatternId();
				const currentPattern = patterns[patternId];

				if (!currentPattern || currentPattern.buttons.length === 0) {
					tagButtonList.textContent = "ã‚¿ã‚°ãƒœã‚¿ãƒ³ãŒã‚ã‚Šã¾ã›ã‚“ã€‚";
					return;
				}

				currentPattern.buttons.forEach((button) => {
					const item = document.createElement("div");
					item.className = "tag-item";

					const infoSpan = document.createElement("span");
					infoSpan.textContent = `${button.name} (${button.tagType})`;

					const editButton = document.createElement("button");
					editButton.textContent = "ç·¨é›†";
					editButton.addEventListener("click", () => openTagModal(button));

					const deleteButton = document.createElement("button");
					deleteButton.textContent = "å‰Šé™¤";
					deleteButton.style.color = "red";
					deleteButton.addEventListener("click", () => {
						if (confirm(`ã‚¿ã‚°ã€Œ${button.name}ã€ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ`)) {
							console.log(`ã‚¿ã‚°ã€Œ${button.name}ã€ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚`);
							currentPattern.buttons = currentPattern.buttons.filter((b) => b.id !== button.id);
							rebuildTagButtons();
							rebuildTagButtonList();
							saveAllPatterns();
						}
					});

					item.appendChild(infoSpan);
					item.appendChild(editButton);
					item.appendChild(deleteButton);
					tagButtonList.appendChild(item);
				});
			};

			// --- ã‚¿ã‚°ãƒœã‚¿ãƒ³ç¾¤ã®å‹•çš„ç”Ÿæˆ ---

			const rebuildTagButtons = () => {
				tagButtonsContainer.innerHTML = "";
				const patternId = getSelectedPatternId();
				const currentPattern = patterns[patternId];
				if (!currentPattern) return;

				currentPattern.buttons.forEach((button) => {
					const btn = document.createElement("button");
					btn.id = `addTagButton-${button.id}`;
					btn.textContent = button.name;

					// ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’å‹•çš„ã«å‰²ã‚Šå½“ã¦
					btn.addEventListener("click", () =>
						createTextarea(button.id, button.tagType, button.name)
					);

					tagButtonsContainer.appendChild(btn);
				});
			};

			// --- å¤‰æ›ãƒ­ã‚¸ãƒƒã‚¯ã®ä¿®æ­£ ---

			/**
			 * é¸æŠã•ã‚ŒãŸãƒ‘ã‚¿ãƒ¼ãƒ³IDã¨ã‚¿ã‚°IDã«åŸºã¥ã„ã¦ã‚«ã‚¹ã‚¿ãƒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¨ã‚¿ã‚¤ãƒ—ã‚’å–å¾—ã™ã‚‹é–¢æ•°
			 */
			const getCustomTagInfo = (tagId) => {
				const patternId = getSelectedPatternId();
				const currentPattern = patterns[patternId];
				if (!currentPattern) return null;

				return currentPattern.buttons.find((b) => b.id === tagId);
			};

			// å…±é€šã®å¤‰æ›ãƒ­ã‚¸ãƒƒã‚¯ (ã‚¿ã‚°ã‚¿ã‚¤ãƒ—ã«å¿œã˜ã¦å‡¦ç†ã‚’æŒ¯ã‚Šåˆ†ã‘ã‚‹ã‚ˆã†ã«å¤‰æ›´)
			function convertTextToHtmlString(textareaElement) {
				const text = textareaElement.value;
				if (!text || text.trim() === "") return ""; // ç©ºç™½/ç©ºã®å ´åˆã¯ç©ºæ–‡å­—ã‚’è¿”ã™

				const tagId = textareaElement.getAttribute("data-tag-id");
				const tagInfo = getCustomTagInfo(tagId);

				// ã‚¿ã‚°æƒ…å ±ãŒãªã„å ´åˆã¯ã€HTMLã‚³ãƒ¡ãƒ³ãƒˆã¨ã—ã¦è­¦å‘Šã‚’è¿”ã™
				if (!tagInfo) return `<!-- è­¦å‘Š: ä¸æ˜ãªã‚¿ã‚°ID (${tagId}) ã®ãŸã‚ã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã¾ã—ãŸ -->\n`;

				// â˜…â˜…â˜…
				// ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒç©ºæ–‡å­—åˆ—ã®å ´åˆã€è­¦å‘Šã‚’è¿”ã™ã‚ˆã†ã«ä¿®æ­£
				// (ä¿®æ­£ã—ãªã„å ´åˆã€ç©ºæ–‡å­—åˆ—ãŒè¿”ã•ã‚Œã€trim()ã§æ¶ˆãˆã¦ã—ã¾ã†ãŸã‚)
				const templateString = tagInfo.template;
				if (templateString.trim() === "") {
					return `<!-- è­¦å‘Š: ã‚¿ã‚° (${tagInfo.name}) ã®é››å½¢ãŒç©ºã®ãŸã‚ã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã¾ã—ãŸ -->\n`;
				}
				// â˜…â˜…â˜…

				const tagType = tagInfo.tagType;
				let output = "";

				if (tagType === "link") {
					// ãƒªãƒ³ã‚¯ã‚¿ã‚°ç³»ã®ç‰¹åˆ¥å‡¦ç† (link)
					const lines = text.trim().split("\n").map((line) => line.trim());
					const linkText = lines[0] || "ãƒªãƒ³ã‚¯";
					const url = lines[1] || "";

					if (url) {
						output = templateString.replace(/\[TEXT\]/g, linkText).replace(/\[URL\]/g, url);
					} else {
						output = `<!-- è­¦å‘Š: ãƒªãƒ³ã‚¯ã‚¨ãƒªã‚¢ã§ã™ãŒURLãŒ2è¡Œç›®ã«æŒ‡å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ (${linkText}) -->\n`;
					}
				} else if (tagType === "p-list") {
					// P+ãƒªã‚¹ãƒˆã‚¿ã‚°ã®å‡¦ç† (p-list)
					const lines = text.trim().split("\n");
					const pText = lines[0] ? lines[0].trim().replace(/\n/g, "<br>") : "ãƒªã‚¹ãƒˆã®ã‚¿ã‚¤ãƒˆãƒ«";
					const listLines = lines.slice(1).filter((line) => line.trim() !== "");

					let listContent = "";
					if (listLines.length > 0) {
						listContent = listLines.map((line) => `<li>${line.trim()}</li>`).join("\n");
					} else {
						listContent = `<li>ãƒªã‚¹ãƒˆé …ç›®ãŒã‚ã‚Šã¾ã›ã‚“</li>`;
					}

					output = templateString.replace(/\[TEXT_P\]/g, pText).replace(/\[TEXT_LIST\]/g, listContent);
				} else if (tagType === "list") {
					// ãƒªã‚¹ãƒˆã‚¿ã‚°ã®å‡¦ç† (list)
					let listContent = text.trim().split("\n")
						.filter((line) => line.trim() !== "")
						.map((line) => {
							// ã™ã§ã«liã‚¿ã‚°ãŒå«ã¾ã‚Œã¦ã„ãŸã‚‰ãã®ã¾ã¾ã€ãã†ã§ãªã‘ã‚Œã°liã‚¿ã‚°ã§å›²ã‚€
							return line.match(/^\s*<li/i) ? line : `<li>${line.trim()}</li>`;
						}).join("\n");

					if (listContent.trim() === "") listContent = `<li>ãƒªã‚¹ãƒˆé …ç›®ãŒã‚ã‚Šã¾ã›ã‚“</li>`;

					output = templateString.replace(/\[TEXT\]/g, listContent);
				} else if (tagType === "single") {
					// å˜ä¸€ã‚¿ã‚°ã®å‡¦ç† (single)
					let content = text.trim().replace(/\n/g, "<br>");
					output = templateString.replace(/\[TEXT\]/g, content);
				} else if (tagType === "link-list") {
					// ãƒªãƒ³ã‚¯ãƒªã‚¹ãƒˆã®å‡¦ç† (link-list)
					const lines = text.trim().split("\n").map((line) => line.trim()).filter((line) => line !== "");
					let linkListContent = "";

					// ã‚«ã‚¹ã‚¿ãƒ ãƒªãƒ³ã‚¯é …ç›®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’å–å¾—ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®šï¼‰
					const linkItemTemplate = tagInfo.linkItemTemplate || '<li class="rtoc-item"><a href="[URL]">[TEXT]</a></li>';

					// 2è¡Œãšã¤ãƒšã‚¢ã«ã—ã¦å‡¦ç† (å¥‡æ•°è¡Œ:TEXT, å¶æ•°è¡Œ:URL)
					for (let i = 0; i < lines.length; i += 2) {
						const linkText = lines[i] || "";
						const linkUrl = lines[i + 1] || "";

						if (linkText && linkUrl) {
							// ã‚«ã‚¹ã‚¿ãƒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½¿ç”¨ã—ã¦å¤‰æ›
							const itemHtml = linkItemTemplate.replace(/\[TEXT\]/g, linkText).replace(/\[URL\]/g, linkUrl);
							linkListContent += itemHtml + "\n";
						} else if (linkText) {
							// URLãŒãªã„å ´åˆã¯è­¦å‘Š
							linkListContent += `<!-- è­¦å‘Š: "${linkText}" ã®URLãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ -->\n`;
						}
					}

					if (linkListContent.trim() === "") {
						linkListContent = `<li class="rtoc-item">ãƒªãƒ³ã‚¯é …ç›®ãŒã‚ã‚Šã¾ã›ã‚“</li>`;
					}

					output = templateString.replace(/\[LINK_LIST\]/g, linkListContent.trim());
				}

				// æœ€å¾Œã«æ”¹è¡Œã‚’åŠ ãˆã¦ãŠã (è¿½è¨˜æ™‚ã«æ‰±ã„ã‚„ã™ã„ã‚ˆã†ã«)
				return output + "\n";
			}

			// æŒ¿å…¥ä½ç½®ã‚»ãƒ¬ã‚¯ã‚¿ã‚’æ›´æ–°ã™ã‚‹é–¢æ•° (å¤‰æ›´ãªã—)
			const updateInsertionPoints = () => {
				const selectedValue = insertionPointSelector.value;

				insertionPointSelector.innerHTML = "";

				const allGroups = container.querySelectorAll(".input-area-group");

				const optionStart = document.createElement("option");
				optionStart.value = "start";
				optionStart.textContent = "ãƒªã‚¹ãƒˆã®å…ˆé ­ (#1 ã¨ã—ã¦è¿½åŠ )";
				insertionPointSelector.appendChild(optionStart);

				allGroups.forEach((group, index) => {
					const tagId = group.querySelector(".input-text-area").getAttribute("data-tag-id");
					// getCustomTagInfo ã‚’ä½¿ã£ã¦æœ€æ–°ã®ã‚¿ã‚°åã‚’å–å¾—
					const tagInfo = getCustomTagInfo(tagId) || { name: "ä¸æ˜ãªã‚¿ã‚°" };

					const currentNumber = index + 1;
					const numberPrefix = group.querySelector(".number-prefix");
					if (numberPrefix) {
						numberPrefix.textContent = `#${currentNumber}`;
					}

					const option = document.createElement("option");
					option.value = group.id;
					option.textContent = `#${currentNumber} ${tagInfo.name} ã®ç›´å¾Œ`;

					insertionPointSelector.appendChild(option);
				});

				const optionEnd = document.createElement("option");
				optionEnd.value = "end";
				optionEnd.textContent = `ãƒªã‚¹ãƒˆã®æœ«å°¾ (#${allGroups.length + 1} ã¨ã—ã¦è¿½åŠ )`;
				insertionPointSelector.appendChild(optionEnd);

				if (selectedValue && Array.from(insertionPointSelector.options).some((opt) => opt.value === selectedValue)) {
					insertionPointSelector.value = selectedValue;
				} else {
					insertionPointSelector.value = allGroups.length === 0 ? "start" : "end";
				}
			};

			// ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã‚’ä½œæˆã—ã€é¸æŠã•ã‚ŒãŸä½ç½®ã«æŒ¿å…¥ã™ã‚‹é–¢æ•° (å¼•æ•°ã‚’å¤‰æ›´)
			const createTextarea = (tagId, tagType, tagName) => {
				areaIndex++;
				const groupDiv = document.createElement("div");
				groupDiv.className = "input-area-group";
				groupDiv.id = `area-group-${areaIndex}`;

				const tagLabel = document.createElement("span");
				tagLabel.className = "input-label-tag";

				const numberPrefix = document.createElement("span");
				numberPrefix.className = "number-prefix";
				tagLabel.appendChild(numberPrefix);

				const tagTextSpan = document.createElement("span");
				tagTextSpan.textContent = tagName;
				tagLabel.appendChild(tagTextSpan);

				const newTextarea = document.createElement("textarea");
				newTextarea.className = `input-text-area input-${tagId}-area`;
				newTextarea.id = `text-area-${tagId}-${areaIndex}`;
				newTextarea.setAttribute("data-tag-id", tagId); // ã‚¿ã‚°IDã‚’ãƒ‡ãƒ¼ã‚¿å±æ€§ã¨ã—ã¦ä¿æŒ

				newTextarea.rows = 3;
				newTextarea.cols = 50;
				newTextarea.style.resize = "vertical";

				let placeholderText = `${tagName}ã‚¿ã‚°ç”¨ã®ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢`;

				if (tagType === "link") {
					placeholderText = `${tagName}ã‚¨ãƒªã‚¢ã€‚1è¡Œç›®: è¡¨ç¤ºãƒ†ã‚­ã‚¹ãƒˆã€2è¡Œç›®: ãƒªãƒ³ã‚¯URL`;
				} else if (tagType === "p-list") {
					placeholderText = `${tagName}ã‚¨ãƒªã‚¢ã€‚1è¡Œç›®: Pã‚¿ã‚°ã®å†…å®¹ã€2è¡Œç›®ä»¥é™: ãƒªã‚¹ãƒˆé …ç›®`;
				} else if (tagType === "single") {
					placeholderText = `${tagName}ã‚¨ãƒªã‚¢ã€‚ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚æ”¹è¡Œã¯<br>ã«ãªã‚Šã¾ã™ã€‚`;
				} else if (tagType === "list") {
					placeholderText = `${tagName}ã‚¨ãƒªã‚¢ã€‚å„è¡ŒãŒliã‚¿ã‚°ã«å¤‰æ›ã•ã‚Œã¾ã™ã€‚`;
				} else if (tagType === "link-list") {
					placeholderText = `${tagName}ã‚¨ãƒªã‚¢ã€‚å¥‡æ•°è¡Œ: ãƒªãƒ³ã‚¯ãƒ†ã‚­ã‚¹ãƒˆã€å¶æ•°è¡Œ: URL ã‚’äº¤äº’ã«å…¥åŠ›`;
				}
				newTextarea.placeholder = placeholderText;

				const deleteButton = document.createElement("button");
				deleteButton.textContent = "å‰Šé™¤";
				deleteButton.className = "delete-input-button";

				deleteButton.addEventListener("click", () => {
					groupDiv.remove();
					updateInsertionPoints();
				});

				groupDiv.appendChild(tagLabel);
				groupDiv.appendChild(newTextarea);
				groupDiv.appendChild(deleteButton);

				const insertPoint = insertionPointSelector.value;

				if (insertPoint === "start") {
					container.prepend(groupDiv);
				} else if (insertPoint === "end") {
					container.appendChild(groupDiv);
				} else {
					const selectedElement = document.getElementById(insertPoint);
					if (selectedElement) {
						container.insertBefore(groupDiv, selectedElement.nextElementSibling);
					} else {
						container.appendChild(groupDiv);
					}
				}

				updateInsertionPoints();
				insertionPointSelector.value = groupDiv.id;
			};

			// --- ãƒšãƒ¼ã‚¸åˆæœŸåŒ– ---
			loadAllPatterns();
			loadShortcuts();
			buildShortcutUI(); // ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆç®¡ç†UIã‚’åˆæœŸè¡¨ç¤º
			rebuildTagButtonList(); // ã‚¿ã‚°ãƒœã‚¿ãƒ³ç®¡ç†ä¸€è¦§ã‚’åˆæœŸè¡¨ç¤º

			// --- ãã®ä»–ã®æ©Ÿèƒ½ (å¤‰æ›´ãªã—) ---

			// é¸æŠç¯„å›²ã‚’ã‚¿ã‚°ã§å›²ã‚€ã‚³ã‚¢é–¢æ•° (å¤‰æ›´ãªã—)
			window.wrapSelectionWithTag = (tagName) => {
				const textarea = document.activeElement;
				if (!textarea || textarea.tagName !== "TEXTAREA" || !textarea.classList.contains("input-text-area")) {
					return;
				}
				const start = textarea.selectionStart;
				const end = textarea.selectionEnd;
				const selectedText = textarea.value.substring(start, end);
				if (selectedText.length === 0) {
					return;
				}

				let openTag;
				let closeTag;

				if (tagName === "a") {
					openTag = `<a href="">`;
					closeTag = `</a>`;
				} else {
					openTag = `<${tagName}>`;
					closeTag = `</${tagName}>`;
				}

				const newText = textarea.value.substring(0, start) + openTag + selectedText + closeTag + textarea.value.substring(end);

				textarea.value = newText;

				let newCursorPos;
				if (tagName === "a") {
					// ã‚«ãƒ¼ã‚½ãƒ«ã‚’ href="" ã®ãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆã®å†…å´ (a href="|") ã«è¨­å®š
					newCursorPos = start + openTag.length - 1;
				} else {
					newCursorPos = start + openTag.length + selectedText.length + closeTag.length;
				}

				textarea.selectionStart = newCursorPos;
				textarea.selectionEnd = newCursorPos;
				textarea.focus();
			};

			// ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ (ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯¾å¿œç‰ˆ)
			document.addEventListener("keydown", function (event) {
				const isModifierKey = event.ctrlKey || event.metaKey;
				if (isModifierKey) {
					const key = event.key.toUpperCase();

					// ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã•ã‚ŒãŸã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆè¨­å®šã‚’ä½¿ç”¨
					if (keyboardShortcuts[key]) {
						const tagName = keyboardShortcuts[key].tag;
						if (tagName) {
							event.preventDefault();
							window.wrapSelectionWithTag(tagName);
						}
					}
				}
			});

			// å‡ºåŠ›ã‚¨ãƒªã‚¢ã‚¯ãƒªã‚¢æ©Ÿèƒ½ (å¤‰æ›´ãªã—)
			if (clearOutputButton) {
				clearOutputButton.addEventListener("click", function () {
					htmlCodeOutput.textContent = "";
				});
			}

			// ã‚³ãƒ¼ãƒ‰ã‚³ãƒ”ãƒ¼æ©Ÿèƒ½ (å¤‰æ›´ãªã—)
			if (copyOutputButton) {
				copyOutputButton.addEventListener("click", async function () {
					const textToCopy = htmlCodeOutput.textContent;
					if (textToCopy.trim().length === 0) {
						// alert("ã‚³ãƒ”ãƒ¼ã™ã‚‹HTMLã‚³ãƒ¼ãƒ‰ãŒã‚ã‚Šã¾ã›ã‚“ã€‚");
						console.warn("ã‚³ãƒ”ãƒ¼ã™ã‚‹HTMLã‚³ãƒ¼ãƒ‰ãŒã‚ã‚Šã¾ã›ã‚“ã€‚");
						return;
					}

					try {
						await navigator.clipboard.writeText(textToCopy);
						const originalText = copyOutputButton.textContent;
						copyOutputButton.textContent = "ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼";
						setTimeout(() => {
							copyOutputButton.textContent = originalText;
						}, 1500);
					} catch (err) {
						console.error("ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã¸ã®æ›¸ãè¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ:", err);
						// navigator.clipboard ãŒä½¿ãˆãªã„ç’°å¢ƒï¼ˆhttpãªã©ï¼‰ã®ãŸã‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
						try {
							const tempTextarea = document.createElement("textarea");
							tempTextarea.value = textToCopy;
							document.body.appendChild(tempTextarea);
							tempTextarea.select();
							document.execCommand("copy");
							document.body.removeChild(tempTextarea);

							const originalText = copyOutputButton.textContent;
							copyOutputButton.textContent = "ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼(FB)";
							setTimeout(() => {
								copyOutputButton.textContent = originalText;
							}, 1500);
						} catch (copyErr) {
							console.error("ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚³ãƒ”ãƒ¼ã«ã‚‚å¤±æ•—ã—ã¾ã—ãŸ:", copyErr);
							// alert ã¯ä½¿ç”¨ã—ãªã„
						}
					}
				});
			}

			// ã€ä¿®æ­£ã€‘ä¸€æ‹¬å¤‰æ›æ©Ÿèƒ½
			if (convertAllButton) {
				convertAllButton.addEventListener("click", function () {
					// å¤‰æ›ç›´å‰ã«è¨­å®šã‚’ä¿å­˜ã—ã€æœ€æ–°ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’å–å¾—ã§ãã‚‹ã‚ˆã†ã«ä¿è¨¼ã—ã¾ã™
					saveAllPatterns();

					const allTextareas = document.querySelectorAll(".input-text-area");
					let outputHtmlString = "";

					if (allTextareas.length === 0) {
						outputHtmlString = "<!-- è­¦å‘Š: å…¥åŠ›ã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ãŒã‚ã‚Šã¾ã›ã‚“ -->\n";
					} else {
						allTextareas.forEach((textarea) => {
							outputHtmlString += convertTextToHtmlString(textarea);
						});
					}

					// æ–°ã—ã„å†…å®¹ãŒç©ºã§ãªã‘ã‚Œã°è¿½è¨˜
					if (outputHtmlString.trim().length > 0) {
						const existingContent = htmlCodeOutput.textContent.trim();
						if (existingContent.length > 0) {
							htmlCodeOutput.textContent += "\n"; // æ—¢å­˜ã®å†…å®¹ãŒã‚ã‚Œã°æ”¹è¡Œã‚’è¿½åŠ 
						}
						// æœ«å°¾ã®ä¸è¦ãªæ”¹è¡Œã‚’å‰Šé™¤ã—ã¦è¿½è¨˜
						htmlCodeOutput.textContent += outputHtmlString.trimEnd();
					}
				});
			}
		});
	</script>
</html>
